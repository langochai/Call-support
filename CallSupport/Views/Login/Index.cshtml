@addTagHelper *,Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="~/assets/bundles/bootstrap-5.3.3/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/assets/bundles/font-awesome/fontawesome.min.css" />
    <style>
        .gradient-custom {
            background: #6a11cb;
            background: linear-gradient(to right, rgba(37,117,252,1), rgba(37,117,252,0.5))
        }
        .btn-parts{
            flex-grow:1;
            min-width:38px;
        }

        .btn-parts .middle{
            min-width:120px
        }
        .error-text{
            color:red;
        }
    </style>
    <title>ĐĂNG NHẬP HỆ THỐNG</title>
</head>

<body>
    <section class="vh-100 gradient-custom">
        <div class="container py-5 h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-12 col-md-8 col-lg-6 col-xl-5">
                    <div class="card bg-dark text-white" style="border-radius: 1rem;">
                        <div class="md-md-5 mt-md-4 pb-5 text-center">
                            <h2 class="text-center">Đăng nhập</h2>
                            <p class="mb-5 message">Vui lòng nhập thông tin đăng nhập</p>
                            <form class="login-card-form" action="Login" method="post" autocomplete="on">
                                <p class="error-text" hidden></p>
                                <div class="form-group mx-5 mb-2">
                                    <input class="form-control"
                                           type="text" placeholder="Tên đăng nhập" id="username" name="username" autofocus required>
                                </div>
                                <div class="form-group mx-5 mb-2">
                                    <input class="form-control"
                                           type="password" placeholder="Mật khẩu" id="password" name="password" required>
                                </div>
                                <div style="width:40%">
                                    <input id="remember_me" type="checkbox" />
                                    <label for="remember_me">Ghi nhớ</label>
                                </div>
                                <div class="d-flex justify-content-center">
                                    <button class="btn btn-outline-light w-50 d-flex" type="submit">
                                        <div class="btn-parts"></div>
                                        <div class="btn-parts">Đăng nhập</div>
                                        <div class="btn-parts"></div>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="~/assets/bundles/jQuery/jquery-3.7.1.min.js"></script>
    <script>
        var submitRequest
        $('form').on('submit', e => {
            e.preventDefault();
            $('.message').removeClass('error-text').text('Vui lòng chờ')
            $('button[type="submit"]').html(
                `<div class="btn-parts"><i class="fa-solid fa-spinner fa-spin-pulse"></i></div></div>
                <div class="btn-parts">Đang đăng nhập</div>
                <div class="btn-parts"></div>`)
            $('button[type="submit"]').attr('disable', 'true')
            if (submitRequest) return
            submitRequest = $.post({
                url: '/Login',
                data: {
                    username: $('#username').val(),
                    password: $('#password').val(),
                },
                success: data => {
                    $('.error-text').fadeOut()
                    $('button[type="submit"]')
                    .html(`<div class="btn-parts"></div>
                            <div class="btn-parts middle"><i class="fa-solid fa-check fa-bounce"></i></div>
                            <div class="btn-parts"></div>`)
                    window.location.href = data;   
                },
                error: err => {
                    err.status == 401 ?
                        $('.message').html(err.responseText) // sai tài khoản hoặc mật khẩu
                        :
                        $('.message').html(err.responseText.substring(0, 50))
                        $('.message').addClass('error-text')
                    $('button[type="submit"]').html(`<div class="btn-parts"></div>
                                                <div class="btn-parts">Đăng nhập</div>
                                                <div class="btn-parts"></div>`)
                    submitRequest = null
                },
                complete: () => {
                    $('button[type="submit"]').removeAttr('disable')
                }
            })
        })
    </script>
</body>
</html>
